<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <head>
        <title>Homepage</title>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/site.css">
        <link rel="stylesheet" href="css/fontawesome.css">
        <link rel="stylesheet" href="css/PNotify.css">
        <link rel="stylesheet" href="css/PNotifyBrightTheme.css">
        <script src="js/jquery.js"></script>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script src="js/fontawesome.js"></script>
        <script src="js/general.js"></script>
        <script src="js/PNotify.js"></script>
    </head>
    
    <body>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-8 col-sm-8 col-md-8 col-lg-4 col-xl-3">
                    <label>Ricerca per Codice Fiscale</label>
                    <input id="wTextStoricoRicerca" type="text" class="form-control" maxlength="16">
                </div>
                <div class="col-4 col-sm-4 col-md-4 col-lg-3 col-xl-1 d-flex align-items-end">
                    <button title="Ricerca" type="button" class="btn btn-info w-100" onclick="GetReservationList()"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="col-12">
                    <div id="wDivStoricoRisultato">
                        <!-- Generato in automatico -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    $(document).ready(function() {
        
    });
    
    async function GetReservationList() {
        var cf = $("#wTextStoricoRicerca").val();
        if (cf.length != 16)
        {
            PushNotification("error", "Il codice fiscale non Ã¨ corretto");
            return;      
        }
        
        var response = await ExecuteApiCall("GET", API_GET_LISTA_PRENOTAZIONI, {"cf": cf});
       
        if (HasHttpSuccessCode(response.code) == false)
        {
            PushNotification("error", response.error_message);
        }

        ClearChildrenNodes("wDivStoricoRisultato");
        
        //Output come tabella
        var tagTable = $('<table></table>').addClass("table");
        tagTableHead = $('<thead><tr></tr></thead>');
        tagTableHead.find("tr").append("<th>ID</th>");
        tagTableHead.find("tr").append("<th>Data/ora</th>");
        tagTableHead.find("tr").append("<th></th>");
        tagTableHead.find("tr").append("<th></th>");
        tagTable.append(tagTableHead);
        
        response = response.response_data;
        console.log(response);
        tagTableBody = $("<tbody></tbody>");
        for (let i = 0; i < response.length; i++)
        {

            var trTag = $("<tr></tr>");
            
            trTag.append(`<td>${response[i].id}</td>`);
            trTag.append(`<td>${response[i].dataOraPrenotazione}</td>`);
            trTag.append(`<td><button title="Modifica" type="button" class="btn btn-primary"><i class="fas fa-edit" onclick="EditReservation('${response[i].id}', '${response[i].cf}')"></i></button></td>`);
            trTag.append(`<td><button title="Elimina" type="button" class="btn btn-danger"><i class="fas fa-trash" onclick=""></i></button></td>`);
            
            tagTableBody.append(trTag);
        }
        
        tagTable.append(tagTableBody);
        
        $("#wDivStoricoRisultato").append(tagTable);
    }

    function EditReservation(id, cf)
    {
        window.location.href = `prenotazione.html?id=${id}&cf=${cf}`; 
    }
</script>
</html>
